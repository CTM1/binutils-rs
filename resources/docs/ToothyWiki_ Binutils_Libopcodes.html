<!DOCTYPE html PUBLIC "-//IETF//DTD HTML//EN">
<!-- saved from url=(0058)https://www.toothycat.net/wiki/wiki.pl?Binutils/libopcodes -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=windows-1252"><title>ToothyWiki: Binutils/Libopcodes</title>
<script language="javascript" src="./ToothyWiki_ Binutils_Libopcodes_files/rot13.js"></script>
<link rel="icon" href="https://www.toothycat.net/favicon.ico"></head><body bgcolor="white">
<h1><a href="http://www.toothycat.net/"><img src="./ToothyWiki_ Binutils_Libopcodes_files/text_logo.jpg" alt="[Home]" border="0" align="right"></a><a href="https://www.toothycat.net/wiki/wiki.pl?search_bb=1&amp;search_ns=Binutils&amp;search=Libopcodes">Binutils/Libopcodes</a></h1>90.63.246.xxx | <a href="https://www.toothycat.net/wiki/wiki.pl?ToothyWiki">ToothyWiki</a> | <a href="https://www.toothycat.net/wiki/wiki.pl?Binutils">Binutils</a> | <a href="https://www.toothycat.net/wiki/wiki.pl?RecentChanges">RecentChanges</a> | <a href="https://www.toothycat.net/wiki/wiki.pl?action=login">Login</a> | <a href="https://www.toothycat.net/apoc/">Webcomic</a><br>
<hr>The libopcodes.so shared library provides functionality to disassemble executable binaries into machine and human readable formats.<br><br><a name="Select_disassembler_for_target_architecture"></a><a name="Select"></a><a name="uid-0"></a><h3>Select disassembler for target architecture</h3>
<br>The binary disassembler class is constructed using a bfd (Binary File Descriptor) class.&nbsp; This is used to select the approprtiate instruction set disassembler.&nbsp; If the requested disassembler is unavailable, this function will return NULL.<br><br><pre>&nbsp;  disassembler_ftype disassemble = disassembler( bfd * bfdFile );<br></pre>
<br><a name="Customise_output_streams"></a><a name="Customise"></a><a name="uid-1"></a><h3>Customise output streams</h3>
<br>Various callbacks to handle the disassembled code can be specified using the disassembler_info class.&nbsp; The primary output is via the printf_ftype callback.&nbsp; This has a similar signature to fprintf (which can be used directly) as below:<br><br><pre>&nbsp;  struct disassembler_info info;<br>&nbsp;  init_disassemble_info ( &amp;info, stdout, (fprintf_ftype)fprintf );<br></pre>
<br>The most common callback override replaces the address display logic.&nbsp; Objdump uses this to resolve hexadecimal addresses to human-readable symbols.<br><br><pre>&nbsp;  void custom_print_address( bfd_vma address, struct disassemble_info * info ) {}<br>&nbsp;  info.print_address_func = custom_print_address;<br></pre>
<br><a name="Disassemble"></a><a name="Disassemble"></a><a name="uid-2"></a><h3>Disassemble</h3>
<br>The disassembler class can be used to disassemble a single instruction at the specified program location.&nbsp; It returns the number of bytes to increment the program location to the next instruction (or negative if the program location is outside the supplied buffer).&nbsp; A section of code than thus be disassembled in a while loop as follows:<br><br><pre>&nbsp;  while ( pc &lt; endPc )<br>&nbsp;  {<br>&nbsp; &nbsp; &nbsp; int count = disassemble( pc, &amp;info );<br>&nbsp; &nbsp; &nbsp; if ( count &lt; 0 ) break;<br>&nbsp; &nbsp; &nbsp; pc += count;<br>&nbsp;  }<br></pre>
<br><a name="Static_program_analysis_"></a><a name="Static"></a><a name="uid-3"></a><h3>Static program analysis (or lack thereof)</h3>
<br>For some architectures (but unfortunately not i386), the disassemble command will set various information about the command that has been disassembled in the disassembler_info structure.<br><br><pre>&nbsp;  info.insn_info_valid - set to non-zero if information is available<br>&nbsp;  info.insn_type&nbsp; &nbsp; &nbsp;  - type of instruction (conditional branch/call/illegal)<br>&nbsp;  info.target&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; - address 1 [e.g. branch destination/data source]<br>&nbsp;  info.target2&nbsp; &nbsp; &nbsp; &nbsp;  - address 2 [e.g. destination address]<br></pre>
<br><a name="Example"></a><a name="Example"></a><a name="uid-4"></a><h3>Example</h3>
<br>The following code opens an executable file and disassembles the .text segment:<br><br><pre>&nbsp;  #include "bfd.h"<br>&nbsp;  #include "dis-asm.h"<br></pre>
<br><pre>&nbsp;  void override_print_address(bfd_vma addr, struct disassemble_info *info)<br>&nbsp;  {<br>&nbsp; &nbsp;  printf( "0x%x", addr );<br>&nbsp;  }<br></pre>
<br><pre>&nbsp;  int main( int argc, char ** argv )<br>&nbsp;  {<br>&nbsp; &nbsp;  bfd&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  * bfdFile;<br>&nbsp; &nbsp;  asection&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; * section;<br>&nbsp; &nbsp;  disassembler_ftype&nbsp; &nbsp; &nbsp; disassemble;<br>&nbsp; &nbsp;  struct disassemble_info info;<br>&nbsp; &nbsp;  unsigned long count, pc;<br></pre>
<br><pre>&nbsp; &nbsp;  bfd_init();<br>&nbsp; &nbsp;  bfdFile = bfd_openr( "/bin/ls", "elf64-x86-64" );<br>&nbsp; &nbsp;  if ( bfdFile == NULL )<br>&nbsp; &nbsp; &nbsp;  {<br>&nbsp; &nbsp; &nbsp; &nbsp;  printf( "Error [%x]: %s\n", bfd_get_error(), bfd_errmsg(bfd_get_error()) );<br>&nbsp; &nbsp; &nbsp; &nbsp;  return -1;<br>&nbsp; &nbsp; &nbsp;  }<br>&nbsp; &nbsp;  if ( !bfd_check_format( bfdFile, bfd_object ))<br>&nbsp; &nbsp; &nbsp;  {<br>&nbsp; &nbsp; &nbsp; &nbsp;  printf( "Error [%x]: %s\n", bfd_get_error(), bfd_errmsg(bfd_get_error()) );<br>&nbsp; &nbsp; &nbsp; &nbsp;  return -1;<br>&nbsp; &nbsp; &nbsp;  }<br>&nbsp; &nbsp;  /* Retrieve the .text code section */<br>&nbsp; &nbsp;  section = bfd_get_section_by_name( bfdFile, ".text" );<br>&nbsp; &nbsp;  if (section == NULL )<br>&nbsp; &nbsp;  {<br>&nbsp; &nbsp; &nbsp;  printf( "Error accessing .text section\n" );<br>&nbsp; &nbsp; &nbsp;  return -1;<br>&nbsp; &nbsp;  }<br></pre>
<br><pre>&nbsp; &nbsp;  /* Construct disassembler_ftype class */<br>&nbsp; &nbsp;  disassemble = disassembler ( bfdFile );<br>&nbsp; &nbsp;  if ( disassemble == NULL )<br>&nbsp; &nbsp;  {<br>&nbsp; &nbsp; &nbsp;  printf( "Error creating disassembler\n" );<br>&nbsp; &nbsp; &nbsp;  return -1;<br>&nbsp; &nbsp;  }<br></pre>
<br><pre>&nbsp; &nbsp;  /* Construct and configure the disassembler_info class using stdout */ <br>&nbsp; &nbsp;  init_disassemble_info ( &amp;info, stdout, (fprintf_ftype)fprintf );<br>&nbsp; &nbsp;  info.print_address_func = override_print_address;<br>&nbsp; &nbsp;  info.arch&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; = bfd_get_arch( bfdFile );<br>&nbsp; &nbsp;  info.mach&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; = bfd_get_mach( bfdFile );<br>&nbsp; &nbsp;  info.buffer_vma&nbsp; &nbsp; = section-&gt;vma;<br>&nbsp; &nbsp;  info.buffer_length = section-&gt;size;<br>&nbsp; &nbsp;  info.section&nbsp; &nbsp; &nbsp;  = section;<br>&nbsp; &nbsp;  bfd_malloc_and_get_section( bfdFile, <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  section, <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;info.buffer );<br>&nbsp; &nbsp;  disassemble_init_for_target ( &amp;info );<br></pre>
<br><pre>&nbsp; &nbsp;  /* Start diassembling at the file start_address */<br>&nbsp; &nbsp;  pc = bfd_get_start_address( bfdFile );<br>&nbsp; &nbsp;  do<br>&nbsp; &nbsp;  {<br>&nbsp; &nbsp; &nbsp;  printf( "0x%x&nbsp; ", pc );<br>&nbsp; &nbsp; &nbsp;  count = disassemble( pc, &amp;info );<br>&nbsp; &nbsp; &nbsp;  pc += count;<br>&nbsp; &nbsp; &nbsp;  printf( "\n" );<br>&nbsp; &nbsp;  } while ( count &gt; 0 &amp;&amp; pc &lt; bfd_get_start_address( bfdFile ) + section-&gt;size );<br>&nbsp; &nbsp;  return 0;<br>&nbsp;  }<br></pre>
<hr>
<table width="100%" cellpadding="0" cellspacing="0" border="0"><tbody><tr><td width="*"><table width="100%" cellpadding="0" cellspacing="0" border="0"><tbody><tr><td width="100%">90.63.246.xxx | <a href="https://www.toothycat.net/wiki/wiki.pl?ToothyWiki">ToothyWiki</a> | <a href="https://www.toothycat.net/wiki/wiki.pl?Binutils">Binutils</a> | <a href="https://www.toothycat.net/wiki/wiki.pl?RecentChanges">RecentChanges</a> | <a href="https://www.toothycat.net/wiki/wiki.pl?action=login">Login</a> | <a href="https://www.toothycat.net/apoc/">Webcomic</a><br>
This page is read-only | <a href="https://www.toothycat.net/wiki/wiki.pl?id=Binutils/Libopcodes&amp;action=history">View other revisions</a> | <a href="https://www.toothycat.net/cgi/log.pl?act=rrx&amp;n=/wiki/wiki.pl?Binutils/Libopcodes">Recently used referrers</a><br>Last edited December 25, 2009 10:25 pm (viewing revision 2, which is the newest) <a href="https://www.toothycat.net/wiki/wiki.pl?id=Binutils/Libopcodes&amp;action=browse&amp;diff=1">(diff)</a></td></tr></tbody></table><table width="100%" cellpadding="0" cellspacing="0" border="0"><tbody><tr><td width="70%" align="left"><form method="post" action="https://www.toothycat.net/wiki/wiki.pl" enctype="application/x-www-form-urlencoded">
<input type="hidden" name="ipmatch" value="90.63.246.187">Search: <input type="text" name="search" size="20"> <label><input type="checkbox" name="search_ww" value="1" checked="checked">Whole words</label> <label><input type="checkbox" name="search_all" value="1" checked="checked">Must contain all</label> <label><input type="checkbox" name="search_title" value="1">Page title search</label><input type="hidden" name="dosearch" value="1"><div><input type="hidden" name=".cgifields" value="search_ww"><input type="hidden" name=".cgifields" value="search_all"><input type="hidden" name=".cgifields" value="search_title"></div>
</form></td><td width="30%" align="right"><form method="post" action="https://www.toothycat.net/wiki/wiki.pl" enctype="application/x-www-form-urlencoded">
<input type="hidden" name="ipmatch" value="90.63.246.187"><input type="submit" name="dorot13" value="Rot13:" onclick="return rot13(rot13text1)"> <input type="text" name="rot13text1" size="20"><input type="hidden" name="rot13tag" value="1"><input type="hidden" name="action" value="browse"><input type="hidden" name="id" value="Binutils/Libopcodes"></form></td></tr></tbody></table></td></tr></tbody></table>

</body></html>