<!DOCTYPE html PUBLIC "-//IETF//DTD HTML//EN">
<!-- saved from url=(0051)https://www.toothycat.net/wiki/wiki.pl?Binutils/bfd -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=windows-1252"><title>ToothyWiki: Binutils/Bfd</title>
<script language="javascript" src="./ToothyWiki_ Binutils_Bfd_files/rot13.js"></script>
<link rel="icon" href="https://www.toothycat.net/favicon.ico"></head><body bgcolor="white">
<h1><a href="http://www.toothycat.net/"><img src="./ToothyWiki_ Binutils_Bfd_files/text_logo.jpg" alt="[Home]" border="0" align="right"></a><a href="https://www.toothycat.net/wiki/wiki.pl?search_bb=1&amp;search_ns=Binutils&amp;search=Bfd">Binutils/Bfd</a></h1>xxx.xxx.xxx.xxx | <a href="https://www.toothycat.net/wiki/wiki.pl?ToothyWiki">ToothyWiki</a> | <a href="https://www.toothycat.net/wiki/wiki.pl?Binutils">Binutils</a> | <a href="https://www.toothycat.net/wiki/wiki.pl?RecentChanges">RecentChanges</a> | <a href="https://www.toothycat.net/wiki/wiki.pl?action=login">Login</a> | <a href="https://www.toothycat.net/apoc/">Webcomic</a><br>
<hr><a name="libbfd"></a><a name="libbfd"></a><a name="uid-0"></a><h3>libbfd</h3>
<br>This library provides functions to read and write the contents of executable binaries and libraries.&nbsp; To use the library, simply include "bfd.h", and link your program against libbdf.so.&nbsp; <br><br>A binary file is represented by an instance of the "bfd" object.&nbsp; Each file is broken into sections represented by "struct bfd_section" objects.&nbsp; These can be retrieved by name.&nbsp; For example, ".text" and ".data" are the standard section names in ELF for the code and data segments.<br><br>Although it would be possible to access the linking information directly from the appropriate bfd_sections, libbfd abstracts this functionality to allow the API to work independently of the binary structure.&nbsp; To achieve this, bfd objects can be used to retrieve arrays of "struct bfd_symbol" that represent entries in the binary's linker tables.<br><br><a name="Primary_bfd_object_methods"></a><a name="Primary"></a><a name="uid-1"></a><h4>Primary bfd object methods</h4>
<br>Class representing a Binary File Descriptor<br><pre>&nbsp;  // Open and close binary files<br>&nbsp;  bfd&nbsp; &nbsp; &nbsp; &nbsp;  * bfd_openr( const char * filename, const char * target );<br>&nbsp;  bfd_boolean&nbsp;  bfd_close( bfd * );<br></pre>
<br><pre>&nbsp;  //&nbsp; Query file properties <br>&nbsp;  char&nbsp; &nbsp; &nbsp; &nbsp; * bfd_get_filename( bfd * );<br>&nbsp;  char&nbsp; &nbsp; &nbsp; &nbsp; * bfd_get_target( bfd * );<br>&nbsp;  bfd_flavour&nbsp;  bfd_get_flavour( bfd * );<br>&nbsp;  flagword&nbsp; &nbsp; &nbsp; bfd_get_flags(&nbsp; bfd * );<br></pre>
<br><pre>&nbsp;  // Address of the start of executable code when loaded into memory (.text section in standard ELF)<br>&nbsp;  bfd_vma&nbsp; &nbsp; &nbsp;  bfd_get_start_address( bfd * );<br></pre>
<br><pre>&nbsp;  // Enumerate or retrieve file sections (for example ".text", ".data")<br>&nbsp;  //<br>&nbsp;  //&nbsp;  Callback prototype is:<br>&nbsp;  //&nbsp;  void callback( bfd * bfdFile,<br>&nbsp;  //&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; struct bfd_section * section,<br>&nbsp;  //&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; void * user_data );<br>&nbsp;  //<br>&nbsp;  void bfd_map_over_sections( bfd *, &amp;callback, void * user_data );<br>&nbsp;  struct bfd_section * get_section_by_name( bfd *, const char * name );<br></pre>
<br><pre>&nbsp;  // Symbol access<br>&nbsp;  long bfd_get_symtab_upper_bound( bfd * );<br>&nbsp;  long bfd_canonicalize_symtab( bfd *, struct bfd_symbol ** symbols );<br></pre>
<br><pre>&nbsp;  long bfd_get_dynamic_symtab_upper_bound( bfd * );<br>&nbsp;  long bfd_canonicalize_dynamic_symtab( bfd *, struct bfd_symbol ** symbols );<br></pre>
<br><a name="Primary_struct_bfd_sections_properties"></a><a name="Primary"></a><a name="uid-2"></a><h4>Primary struct bfd_sections properties</h4>
<br>Class representing a section in an binary file<br><pre>&nbsp;  // Section name<br>&nbsp;  const char&nbsp; &nbsp; * name;<br></pre>
<br><pre>&nbsp;  //&nbsp; Address and size of section when loaded into memory<br>&nbsp;  bfd_vma&nbsp; &nbsp; &nbsp; &nbsp;  vma;<br>&nbsp;  bfd_size_type&nbsp;  size;<br></pre>
<br><a name="Primary_"></a><a name="Primary"></a><a name="uid-3"></a><h4>Primary "struct bfd_symbol" properties</h4>
<br>Class representing an entry in one of the binary's symbol table<br><pre>&nbsp;  //&nbsp; The symbol name, the section it resides in, and standard symbol information structure<br>&nbsp;  const char * name<br>&nbsp;  struct bfd_section * section<br>&nbsp;  void bfd_symbol_info( struct bfd_symbol *, symbol_info * info ); <br></pre>
<br><a name="Example"></a><a name="Example"></a><a name="uid-4"></a><h4>Example: Opening an existing binary file</h4>
<br>This code opens /bin/ls as an 64-bit x86 ELF binary.&nbsp; Note that it is necessary to call bfd_check_format() before using the bfd instance.<br><br><pre>&nbsp;  bfd_init();<br></pre>
<br><pre>&nbsp;  bfd * bfdFile = bfd_openr( "/bin/ls", "elf64-x86-64" );<br>&nbsp;  if ( bfdFile == NULL )<br>&nbsp;  {<br>&nbsp; &nbsp; &nbsp;  printf( "Error [%x]: %s\n", bfd_get_error(), bfd_errmsg(bfd_get_error()) );<br>&nbsp; &nbsp; &nbsp;  return;<br>&nbsp;  }<br></pre>
<br><pre>&nbsp;  if ( !bfd_check_format( bfdFile, bfd_object ))<br>&nbsp;  {<br>&nbsp; &nbsp; &nbsp;  printf( "Error [%x]: %s\n", bfd_get_error(), bfd_errmsg(bfd_get_error()) );<br>&nbsp; &nbsp; &nbsp;  return;<br>&nbsp;  }<br></pre>
<br><pre>&nbsp;  // Program goes here<br></pre>
<br><pre>&nbsp;  bfd_close( bfdFile );<br></pre>
<br><a name="Reading_symbol_tables"></a><a name="Reading"></a><a name="uid-5"></a><h4>Reading symbol tables</h4>
<br>Retrieving the symbols included in the bfd file is slightly more complicated (you need to pass in a buffer of appropriate size). The code below extracts the dynamic symbols from a bfd instance (static symbols are similar):<br><br><pre>&nbsp; &nbsp; struct bfd_symbol ** symbols;<br>&nbsp; &nbsp; long&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  symbolsSize;<br>&nbsp; &nbsp; long&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  symbolsCount;<br></pre>
<br><pre>&nbsp; &nbsp; long i;<br></pre>
<br><pre>&nbsp; &nbsp; // Calculate required buffer size<br>&nbsp; &nbsp; symbolsSize = bfd_get_dynamic_symtab_upper_bound( bfdFile );<br>&nbsp; &nbsp; if ( symbolsSize &lt; 0 )<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; printf( "Error [%x]: %s\n", bfd_get_error(), bfd_errmsg(bfd_get_error()) );<br>&nbsp; &nbsp; &nbsp; return;<br>&nbsp; &nbsp; }<br></pre>
<br><pre>&nbsp; &nbsp; // Allocate buffer<br>&nbsp; &nbsp; symbols = malloc( symbolsSize );<br>&nbsp; &nbsp; if ( symbols == NULL )<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; printf( "Could not allocate memory\n" );<br>&nbsp; &nbsp; &nbsp; return;<br>&nbsp; &nbsp; }<br></pre>
<br><pre>&nbsp; &nbsp; // Retrieve unpacked symbols<br>&nbsp; &nbsp; symbolsCount = bfd_canonicalize_dynamic_symtab( bfdFile, symbols );<br>&nbsp; &nbsp; if ( symbolsCount &lt; 0 )<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; printf( "Error [%x]: %s\n", bfd_get_error(), bfd_errmsg(bfd_get_error()) );<br>&nbsp; &nbsp; &nbsp; free( symbols );<br>&nbsp; &nbsp; &nbsp; return;<br>&nbsp; &nbsp; }<br></pre>
<br><pre>&nbsp; &nbsp; // List symbols<br>&nbsp; &nbsp; for ( i = 0; i &lt; symbolsCount; i++ )<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; printf( "Symbol [flags %x][value %x] %s\n", symbols[i]-&gt;flags, symbols[i]-&gt;value, symbols[i]-&gt;name );<br>&nbsp; &nbsp; } <br></pre>
<br><pre>&nbsp; &nbsp; free( symbols );<br></pre>
<br><a name="Modifying_and_linking_binary_files"></a><a name="Modifying"></a><a name="uid-6"></a><h4>Modifying and linking binary files</h4>
<br>In addition to examining existing files, libbfd also has functionality for creating and modifying them.&nbsp; The most advanced functionality is in the area of code disassemble/reassembly and linking.&nbsp; This can even support code compiled for different machine architectures.<br><hr>
<table width="100%" cellpadding="0" cellspacing="0" border="0"><tbody><tr><td width="*"><table width="100%" cellpadding="0" cellspacing="0" border="0"><tbody><tr><td width="100%">xxx.xxx.xxx.xxx | <a href="https://www.toothycat.net/wiki/wiki.pl?ToothyWiki">ToothyWiki</a> | <a href="https://www.toothycat.net/wiki/wiki.pl?Binutils">Binutils</a> | <a href="https://www.toothycat.net/wiki/wiki.pl?RecentChanges">RecentChanges</a> | <a href="https://www.toothycat.net/wiki/wiki.pl?action=login">Login</a> | <a href="https://www.toothycat.net/apoc/">Webcomic</a><br>
This page is read-only | <a href="https://www.toothycat.net/wiki/wiki.pl?id=Binutils/Bfd&amp;action=history">View other revisions</a> | <a href="https://www.toothycat.net/cgi/log.pl?act=rrx&amp;n=/wiki/wiki.pl?Binutils/Bfd">Recently used referrers</a><br>Last edited January 12, 2009 11:10 pm (viewing revision 1, which is the newest) <a href="https://www.toothycat.net/wiki/wiki.pl?id=Binutils/Bfd&amp;action=browse&amp;diff=1">(diff)</a></td></tr></tbody></table><table width="100%" cellpadding="0" cellspacing="0" border="0"><tbody><tr><td width="70%" align="left"><form method="post" action="https://www.toothycat.net/wiki/wiki.pl" enctype="application/x-www-form-urlencoded">
<input type="hidden" name="ipmatch" value="xxx.xxx.xxx.xxx">Search: <input type="text" name="search" size="20"> <label><input type="checkbox" name="search_ww" value="1" checked="checked">Whole words</label> <label><input type="checkbox" name="search_all" value="1" checked="checked">Must contain all</label> <label><input type="checkbox" name="search_title" value="1">Page title search</label><input type="hidden" name="dosearch" value="1"><div><input type="hidden" name=".cgifields" value="search_ww"><input type="hidden" name=".cgifields" value="search_all"><input type="hidden" name=".cgifields" value="search_title"></div>
</form></td><td width="30%" align="right"><form method="post" action="https://www.toothycat.net/wiki/wiki.pl" enctype="application/x-www-form-urlencoded">
<input type="hidden" name="ipmatch" value="xxx.xxx.xxx.xxx"><input type="submit" name="dorot13" value="Rot13:" onclick="return rot13(rot13text1)"> <input type="text" name="rot13text1" size="20"><input type="hidden" name="rot13tag" value="1"><input type="hidden" name="action" value="browse"><input type="hidden" name="id" value="Binutils/Bfd"></form></td></tr></tbody></table></td></tr></tbody></table>

</body></html>
